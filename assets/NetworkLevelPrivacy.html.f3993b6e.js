import{_ as c,r as s,o as d,c as h,a as e,d as a,w as i,b as t,e as r}from"./app.856148fd.js";const u={},f=e("h1",{id:"network-level-privacy-bitcoin-core-vs-wasabi-wallet",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#network-level-privacy-bitcoin-core-vs-wasabi-wallet","aria-hidden":"true"},"#"),t(" Network-Level Privacy - Bitcoin Core vs Wasabi Wallet")],-1),b=e("p",null,"Bitcoin is a peer-to-peer network of full nodes that define, verify, and enforce the Bitcoin consensus rules. There is a lot of communication between them and metadata can be used to de-anonymize Bitcoin users.",-1),p={class:"table-of-contents"},m=e("h2",{id:"problem",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#problem","aria-hidden":"true"},"#"),t(" Problem")],-1),v=e("h3",{id:"clearnet-light-clients",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#clearnet-light-clients","aria-hidden":"true"},"#"),t(" Clearnet light clients")],-1),g=e("p",null,"When the communication to the network is unencrypted over clearnet, then there is an easy correlation of the Bitcoin transactions to the IP address of the peer who sent it. The IP address can even be used to find the physical location of the user!",-1),y=e("p",null,"A Bitcoin full node broadcasts not just the transactions of its user, but it also gossips all of the other transactions that it has received from its peers. Thus it is very difficult to find out which transactions originated from which full node. However, when a node or a wallet does not gossip all transactions, but only the transactions of its user, then it is easier to find out which node has sent those specific transactions.",-1),w={href:"https://github.com/bitcoin/bips/blob/master/bip-0037.mediawiki",target:"_blank",rel:"noopener noreferrer"},k={href:"https://jonasnick.github.io/blog/2015/02/12/privacy-in-bitcoinj/",target:"_blank",rel:"noopener noreferrer"},_={href:"https://www.reddit.com/r/Bitcoin/comments/2feox9/electrum_securityprivacy_model/ck8szc0/",target:"_blank",rel:"noopener noreferrer"},T=r('<div class="custom-container danger"><p class="custom-container-title">DANGER</p><p>When the user sends the extended public key or a filter of all the addresses to the central server, then the server can <strong>COMPLETELY</strong> deanonymize the users.</p></div><h2 id="wasabi-s-solution" tabindex="-1"><a class="header-anchor" href="#wasabi-s-solution" aria-hidden="true">#</a> Wasabi&#39;s solution</h2><h3 id="full-node-by-default-block-filters-over-tor" tabindex="-1"><a class="header-anchor" href="#full-node-by-default-block-filters-over-tor" aria-hidden="true">#</a> Full node by default &amp; block filters over Tor</h3><p>Wasabi checks if there is a local Tor instance installed, and if so, it uses this to onion-route all the traffic to and from the network. If Tor is not already installed, then it is accessed automatically from within Wasabi. This means that by default, all network communication is secured from outside snooping and the IP address is hidden.</p>',4),B={href:"https://github.com/bitcoin/bitcoin",target:"_blank",rel:"noopener noreferrer"},x={class:"custom-container tip"},P=e("p",{class:"custom-container-title"},"Wasabi ships with Bitcoin Knots!",-1),W={href:"https://github.com/bitcoin/bips/blob/master/bip-0158.mediawiki",target:"_blank",rel:"noopener noreferrer"},I=r('<div class="custom-container tip"><p class="custom-container-title">Privacy by default!</p><p>Wasabi has network-level privacy as good as a Bitcoin full node.</p></div><h2 id="in-depth-comparison" tabindex="-1"><a class="header-anchor" href="#in-depth-comparison" aria-hidden="true">#</a> In-depth comparison</h2><p>Furthermore, network-level privacy consists of two sub-categories.</p><ul><li>Private UTXO Retrieval</li><li>Private Transaction Broadcasting</li></ul><h3 id="bitcoin-core" tabindex="-1"><a class="header-anchor" href="#bitcoin-core" aria-hidden="true">#</a> Bitcoin Core</h3><h4 id="private-utxo-retrieval" tabindex="-1"><a class="header-anchor" href="#private-utxo-retrieval" aria-hidden="true">#</a> Private UTXO retrieval</h4><p>Bitcoin Core downloads all the blocks ever created and establishes your wallet balances locally. This is as good as it gets.</p><h4 id="private-transaction-broadcasting" tabindex="-1"><a class="header-anchor" href="#private-transaction-broadcasting" aria-hidden="true">#</a> Private transaction broadcasting</h4><p>Bitcoin Core broadcasts transactions to other peers on the clearnet, unencrypted. Other peers cannot figure out which transaction originates from a specific node because Core does not only broadcast its own transactions but also propagates every other transaction that hits its mempool. However, some papers note it’s not bulletproof:</p>',9),C={href:"https://github.com/bitcoin/bips/blob/master/bip-0156.mediawiki",target:"_blank",rel:"noopener noreferrer"},A=r('<h4 id="adversaries-identified" tabindex="-1"><a class="header-anchor" href="#adversaries-identified" aria-hidden="true">#</a> Adversaries identified</h4><ul><li>Malicious Peer</li><li>Supernode</li></ul><h3 id="bitcoin-core-tor" tabindex="-1"><a class="header-anchor" href="#bitcoin-core-tor" aria-hidden="true">#</a> Bitcoin Core + Tor</h3><p>You can use Bitcoin Core with Tor, which solves some of the above-mentioned issues. In this case, a supernode cannot track back transactions to your IP address.</p><p>An entity that can break Tor is a universal adversary, however, most Tor attacks are not possible if exit nodes are not involved. It is reasonable to assume that this entity can break the onion routing, not Tor&#39;s encryption itself.</p><h4 id="adversaries-identified-1" tabindex="-1"><a class="header-anchor" href="#adversaries-identified-1" aria-hidden="true">#</a> Adversaries identified</h4><ul><li>Tor breaker</li></ul><h3 id="wasabi-wallet-light-node" tabindex="-1"><a class="header-anchor" href="#wasabi-wallet-light-node" aria-hidden="true">#</a> Wasabi Wallet light node</h3><h4 id="private-utxo-retrieval-1" tabindex="-1"><a class="header-anchor" href="#private-utxo-retrieval-1" aria-hidden="true">#</a> Private UTXO retrieval</h4><p>The backend server serves block filters to all the clients over Tor. From those filters, the clients figure out which blocks they are interested in and download them [and some false positive blocks] from peers. One block per peer, and always over a fresh Tor stream. When a block is acquired, the peer gets disconnected. Because of the end-to-end encryption of the onion network, it immediately defeats an ISP adversary and makes the already impossible job of the Sybil adversary even more impossible. The only adversary that could possibly overcome this would have to setup thousands of full nodes over Tor and also break Tor itself.</p><h4 id="private-transaction-broadcasting-1" tabindex="-1"><a class="header-anchor" href="#private-transaction-broadcasting-1" aria-hidden="true">#</a> Private transaction broadcasting</h4><p>All Wasabi traffic is tunneled through Tor. Wasabi connects only to onion nodes, so end-to-end encryption is enforced between the wallet and peers. All this without involving any exit node. Wasabi connects to each peer through a different Tor stream. A new Bitcoin peer is chosen for every transaction broadcast.</p><div class="custom-container tip"><p class="custom-container-title">Everything over Tor!</p><p>Wasabi broadcast transactions to only one peer over Tor, and immediately after that the peer is disconnected.</p></div><h4 id="adversaries-identified-2" tabindex="-1"><a class="header-anchor" href="#adversaries-identified-2" aria-hidden="true">#</a> Adversaries identified</h4><ul><li>ISP</li><li>Tor Breaker Sybil Attacker With Thousands Of Full Nodes Over Onion</li></ul><h3 id="wasabi-wallet-full-node" tabindex="-1"><a class="header-anchor" href="#wasabi-wallet-full-node" aria-hidden="true">#</a> Wasabi Wallet + full node</h3><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>Wasabi has a partial Bitcoin Knots integration. This means that it is possible (but not mandatory) to start Bitcoin Knots during the launch of Wasabi, without having to install or configure anything manually.</p></div><h4 id="private-utxo-retrieval-2" tabindex="-1"><a class="header-anchor" href="#private-utxo-retrieval-2" aria-hidden="true">#</a> Private UTXO retrieval</h4><p>If you have a listening full node running in the background (not only Bitcoin Core, any full node) then Wasabi automatically picks it up and instead of asking peers for blocks, it asks for blocks from your own node. Using Wasabi this way results in the same privacy model as Bitcoin Core&#39;s, regarding Private UTXO Retrieval.</p><h4 id="private-transaction-broadcasting-2" tabindex="-1"><a class="header-anchor" href="#private-transaction-broadcasting-2" aria-hidden="true">#</a> Private transaction broadcasting</h4><p>Even when Wasabi is connected to your own node, it will broadcast the transaction in the above-described way: to one new peer over Tor.</p><h2 id="universal-attacks" tabindex="-1"><a class="header-anchor" href="#universal-attacks" aria-hidden="true">#</a> Universal Attacks</h2><p>Every time you use software that interacts with a Bitcoin network, and especially a Bitcoin node, you leave a sticky fingerprint in your traffic. It comes in the form of a small but unavoidable spike in volume every time a new block is mined and the nodes start gossiping about it. The blocks in Bitcoin are quite big, and the propagation speed is critical for consensus (greater delay means more frequent accidental forks), so such effect is predictable, and, in a sense, inherent to the Bitcoin architecture.</p>',23),N={href:"https://github.com/bitcoin/bips/blob/master/bip-0152.mediawiki",target:"_blank",rel:"noopener noreferrer"},S={href:"https://m417z.com/bitsniff/",target:"_blank",rel:"noopener noreferrer"},q=r('<h3 id="protection" tabindex="-1"><a class="header-anchor" href="#protection" aria-hidden="true">#</a> Protection</h3><p>There are many ways to go about it, but staying completely undetected is far from trivial - traditional privacy-enhancing tools mostly focus on the packet level, which is orthogonal to the technique. Let’s break down the potential defense vectors.</p><ul><li><p><strong>VPN / Tor</strong> - unlikely to affect the time series shape much, and therefore for larger traffic lengths the statistical significance of block-related spikes will inevitably become overwhelming.</p></li><li><p><strong>Traffic mixing</strong> - for traffic volumes that are orders of magnitude higher than Bitcoin P2P communications, mixing is likely to be very effective. That would, however, demand constant shielding of both upstream and downstream communications, and couldn&#39;t be done effectively by just running the node on a general-purpose machine - any noticeably long unshielded period may be enough for detection.</p></li><li><p><strong>Being your own ISP</strong> - too spicy for most, but that should work.</p></li><li><p><strong>Blockstream Satellite</strong> - the ultimate solution. Eliminates the traffic analysis threat altogether.</p></li></ul><p>Beyond active measures available now, both the privacy and the bandwidth efficiency of Bitcoin communications are actively worked on. It is entirely possible that the messaging protocol will get to the point where block propagation doesn&#39;t trigger any significant spikes in traffic volume.</p>',4),E={href:"https://79jke.github.io/BitSniff/",target:"_blank",rel:"noopener noreferrer"},O={href:"https://m417z.com/bitsniff/",target:"_blank",rel:"noopener noreferrer"},L={href:"https://youtu.be/9S8xsDq3PTU",target:"_blank",rel:"noopener noreferrer"},U=e("img",{src:"https://img.youtube.com/vi/9S8xsDq3PTU/maxresdefault.jpg",alt:"Watch the video"},null,-1);function j(V,F){const o=s("router-link"),n=s("ExternalLinkIcon"),l=s("RouterLink");return d(),h("div",null,[f,b,e("nav",p,[e("ul",null,[e("li",null,[a(o,{to:"#problem"},{default:i(()=>[t("Problem")]),_:1}),e("ul",null,[e("li",null,[a(o,{to:"#clearnet-light-clients"},{default:i(()=>[t("Clearnet light clients")]),_:1})])])]),e("li",null,[a(o,{to:"#wasabi-s-solution"},{default:i(()=>[t("Wasabi's solution")]),_:1}),e("ul",null,[e("li",null,[a(o,{to:"#full-node-by-default-block-filters-over-tor"},{default:i(()=>[t("Full node by default & block filters over Tor")]),_:1})])])]),e("li",null,[a(o,{to:"#in-depth-comparison"},{default:i(()=>[t("In-depth comparison")]),_:1}),e("ul",null,[e("li",null,[a(o,{to:"#bitcoin-core"},{default:i(()=>[t("Bitcoin Core")]),_:1})]),e("li",null,[a(o,{to:"#bitcoin-core-tor"},{default:i(()=>[t("Bitcoin Core + Tor")]),_:1})]),e("li",null,[a(o,{to:"#wasabi-wallet-light-node"},{default:i(()=>[t("Wasabi Wallet light node")]),_:1})]),e("li",null,[a(o,{to:"#wasabi-wallet-full-node"},{default:i(()=>[t("Wasabi Wallet + full node")]),_:1})])])]),e("li",null,[a(o,{to:"#universal-attacks"},{default:i(()=>[t("Universal Attacks")]),_:1}),e("ul",null,[e("li",null,[a(o,{to:"#protection"},{default:i(()=>[t("Protection")]),_:1})])])])])]),m,v,g,y,e("p",null,[t("There are light wallets, which query a backend server to get information regarding specific addresses or use "),e("a",w,[t("BIP 37"),a(n)]),t(" bloom filtering SPV wallet protocol, which is "),e("a",k,[t("extremely bad for privacy"),a(n)]),t(". And there is Electrum, which "),e("a",_,[t("sends your addresses"),a(n)]),t(" to random Electrum servers.")]),T,e("p",null,[t("In order to fully verify everything, running a full node is essential. If "),e("a",B,[t("bitcoind"),a(n)]),t(" is installed and run on the same computer as Wasabi, then it will automatically and by default connect to the full node. It is also possible to connect Wasabi to a remote full node on another computer by specifying the local IP address or Tor onion service in the settings. Then, Wasabi pulls the verified blocks and queries the mempool from the full node.")]),e("div",x,[P,e("p",null,[t("Wasabi has a "),a(l,{to:"/using-wasabi/BitcoinFullNode.html"},{default:i(()=>[t("partial Bitcoin Knots integration")]),_:1}),t(". This means that it is possible (but not mandatory) to start Bitcoin Knots during the launch of Wasabi, without having to install or configure anything manually.")])]),e("p",null,[t("However, even if no full node is installed, Wasabi has a light client mode based on "),e("a",W,[t("BIP 158 block filters"),a(n)]),t(". The Wasabi server sends a filter of all the transactions in each block to all the users. Then, users check locally if the block contains any transactions with their addresses. If not, then the filter is stored for later reference, and no block is downloaded. However, if there is a user transaction in that block, then Wasabi connects to a random Bitcoin P2P node over Tor and asks for this entire block, not only one transaction. This block request is indistinguishable from the regular P2P gossip, and thus nobody, neither the server nor the full node, know which addresses belong to the user.")]),I,e("blockquote",null,[e("p",null,[t("Bitcoin transaction propagation does not hide the source of a transaction very well, especially against a “supernode” eavesdropper that forms a large number of outgoing connections to reachable nodes on the network. "),e("a",C,[t("Dandelion: Privacy-Preserving Transaction Propagation"),a(n)]),t(".")])]),A,e("p",null,[t("Notably, the volume of block-related messages was drastically reduced since the introduction of Compact Block Relay ("),e("a",N,[t("BIP 152"),a(n)]),t(". Instead of requesting whole blocks, mostly consisting of transactions already known to the node, the peer informed of a new block is only requesting the missing transactions. Yet the amount of extra communications in the seconds following a new block is still considerable. This effect may not be noticeable for a single block, but over time it gets statistically significant and may get exploited.")]),e("p",null,[t("As reported by "),e("a",S,[t("Niko Kudriastev and Michael Maltsev"),a(n)]),t(", it is possible to detect Bitcoin communications using nothing but traffic volume over time - a piece of information even most privacy concerned individuals are likely leaking to their law-abiding Internet Service Provider. In this case, using a VPN and running the node over Tor may not be enough to avoid being detected.")]),q,e("p",null,[t("You can read more about BitSniff "),e("a",E,[t("here"),a(n)]),t(" and check the interactive demo "),e("a",O,[t("here"),a(n)]),t(".")]),e("p",null,[e("a",L,[U,a(n)])])])}const R=c(u,[["render",j],["__file","NetworkLevelPrivacy.html.vue"]]);export{R as default};
