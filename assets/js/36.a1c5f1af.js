(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{298:function(e,t,a){"use strict";a.r(t);var r=a(22),o=Object(r.a)({},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"network-level-privacy-bitcoin-core-vs-wasabi-wallet"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#network-level-privacy-bitcoin-core-vs-wasabi-wallet","aria-hidden":"true"}},[e._v("#")]),e._v(" Network Level Privacy - Bitcoin Core vs Wasabi Wallet")]),e._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#terminology"}},[e._v("Terminology")])]),a("li",[a("a",{attrs:{href:"#zooming-out"}},[e._v("Zooming Out")])]),a("li",[a("a",{attrs:{href:"#bitcoin-core"}},[e._v("Bitcoin Core")]),a("ul",[a("li",[a("a",{attrs:{href:"#private-utxo-retrieval"}},[e._v("Private UTXO Retrieval")])]),a("li",[a("a",{attrs:{href:"#private-transaction-broadcasting"}},[e._v("Private Transaction Broadcasting")])]),a("li",[a("a",{attrs:{href:"#adversaries-identified"}},[e._v("Adversaries Identified")])])])]),a("li",[a("a",{attrs:{href:"#bitcoin-core-tor"}},[e._v("Bitcoin Core + Tor")]),a("ul",[a("li",[a("a",{attrs:{href:"#adversaries-identified"}},[e._v("Adversaries Identified")])])])]),a("li",[a("a",{attrs:{href:"#wasabi-wallet"}},[e._v("Wasabi Wallet")]),a("ul",[a("li",[a("a",{attrs:{href:"#private-transaction-broadcasting"}},[e._v("Private Transaction Broadcasting")])]),a("li",[a("a",{attrs:{href:"#private-utxo-retrieval"}},[e._v("Private UTXO Retrieval")])]),a("li",[a("a",{attrs:{href:"#adversaries-identified"}},[e._v("Adversaries Identified")])])])]),a("li",[a("a",{attrs:{href:"#wasabi-wallet-full-node"}},[e._v("Wasabi Wallet + Full Node")]),a("ul",[a("li",[a("a",{attrs:{href:"#private-utxo-retrieval"}},[e._v("Private UTXO Retrieval")])])])]),a("li",[a("a",{attrs:{href:"#conclusion"}},[e._v("Conclusion")])])])]),a("p"),e._v(" "),a("hr"),e._v(" "),a("p",[e._v("Bitcoin Core, more specifically full nodes are considered to be the pinnacle of network level privacy in Bitcoin wallets that no other wallet type can come close to.\nIt is not difficult to see why: full nodes download the whole Blockchain and establish your wallet balances locally, so there is zero chance of any third party figuring out which addresses are in your wallet and which addresses are not.")]),e._v(" "),a("p",[e._v("Compare this to other light wallets, which query a backend server to get information regarding specific addresses or use "),a("a",{attrs:{href:"https://github.com/bitcoin/bips/blob/master/bip-0037.mediawiki",target:"_blank",rel:"noopener noreferrer"}},[e._v("BIP37"),a("OutboundLink")],1),e._v(" bloom filtering SPV wallet protocol, which is probably "),a("a",{attrs:{href:"https://jonasnick.github.io/blog/2015/02/12/privacy-in-bitcoinj/",target:"_blank",rel:"noopener noreferrer"}},[e._v("even worse"),a("OutboundLink")],1),e._v(".\nAnd there is Electrum, which "),a("a",{attrs:{href:"https://www.reddit.com/r/Bitcoin/comments/2feox9/electrum_securityprivacy_model/ck8szc0/",target:"_blank",rel:"noopener noreferrer"}},[e._v("sends your addresses"),a("OutboundLink")],1),e._v(" to random Electrum servers.")]),e._v(" "),a("p",[e._v("The vision of a light wallet that does not leak too much information while establishing the user’s UTXO set had haunted Bitcoin developers for centuries.\nIn fact, even BIP37 started out as a privacy improvement, it just turned out to be not one later.\nBut there were decent attempts: some developers, like Jonas Schnelli, the Stratis team and myself "),a("a",{attrs:{href:"https://github.com/bitcoin/bitcoin/pull/9076",target:"_blank",rel:"noopener noreferrer"}},[e._v("built"),a("OutboundLink")],1),e._v(" "),a("a",{attrs:{href:"https://github.com/stratisproject/Breeze",target:"_blank",rel:"noopener noreferrer"}},[e._v("wallet"),a("OutboundLink")],1),e._v(" "),a("a",{attrs:{href:"https://github.com/zkSNACKs/WalletWasabi/tree/hiddenwallet-v0.6",target:"_blank",rel:"noopener noreferrer"}},[e._v("software"),a("OutboundLink")],1),e._v(" that only downloaded blocks from the creation of the user’s wallet.\nSome devs, like Nicolas Dorier attempted to "),a("a",{attrs:{href:"https://github.com/NicolasDorier/NBitcoin.SPVSample",target:"_blank",rel:"noopener noreferrer"}},[e._v("patch"),a("OutboundLink")],1),e._v(" the BIP37 and some others, like the guys at Lightning Labs came up with a whole new light wallet architecture: BIP"),a("a",{attrs:{href:"https://github.com/bitcoin/bips/blob/master/bip-0157.mediawiki",target:"_blank",rel:"noopener noreferrer"}},[e._v("157"),a("OutboundLink")],1),e._v("-"),a("a",{attrs:{href:"https://github.com/bitcoin/bips/blob/master/bip-0158.mediawiki",target:"_blank",rel:"noopener noreferrer"}},[e._v("158"),a("OutboundLink")],1),e._v(".\nThe MoneroWorld folks want you to delegate "),a("a",{attrs:{href:"https://moneroworld.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("running your node to the cloud"),a("OutboundLink")],1),e._v(".\nThere were also others, like Chris Belcher, who said: “fuck that” and created "),a("a",{attrs:{href:"https://github.com/chris-belcher/electrum-personal-server",target:"_blank",rel:"noopener noreferrer"}},[e._v("Electrum Personal Server"),a("OutboundLink")],1),e._v(" that lets you connect your Electrum client to your full node.\nFinally I have been noticing a positive trend recently of companies selling "),a("a",{attrs:{href:"https://www.nodl.it",target:"_blank",rel:"noopener noreferrer"}},[e._v("boxes"),a("OutboundLink")],1),e._v(" those will run a full node for you out of the box.")]),e._v(" "),a("p",[e._v("And then, there’s "),a("a",{attrs:{href:"https://wasabiwallet.io",target:"_blank",rel:"noopener noreferrer"}},[e._v("Wasabi Wallet"),a("OutboundLink")],1),e._v(", which is a BIP157-ish client side filtering light wallet and partly integrates to your full node, too.\nWhich brings me to the topic of this article: Just a few hours ago, with Wasabi Wallet, we achieved the best network level privacy that is possible with today’s Bitcoin.")]),e._v(" "),a("h2",{attrs:{id:"terminology"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#terminology","aria-hidden":"true"}},[e._v("#")]),e._v(" Terminology")]),e._v(" "),a("p",[a("code",[e._v("V")]),e._v(" Stands for Verification or Validation.\nThey are used interchangeably, but I’m pretty sure one of it is correct.\nVeridation?")]),e._v(" "),a("p",[a("code",[e._v("FN")]),e._v(", Full Node, Fully Veridating Node.\nDownloads and veridates all the Bitcoin blocks ever created, but for our purposes (privacy) only the downloading part matters.")]),e._v(" "),a("p",[a("code",[e._v("SPV Node")]),e._v(", Simplified Payment Veridating Node.\nOnly synchronizes the header chain (whatever that is) and can veridate that you have a transaction by applying some merkle magic.\nNone of this matters for us though.\nThe important thing is to notice that SPV has nothing to do with privacy, it’s really just a way of making sure transactions happened.\nBy extension a full node has nothing to do with privacy either.\nIt’s just describing how the node makes sure transactions happened.\nIt veridates the whole blockchain, of course in order to do so, it has to download the whole blockchain, which enables wallet UTXO retrieval locally, which is the most private way to do that.\nWait, so it has something to do with privacy after all?")]),e._v(" "),a("p",[a("code",[e._v("Full-SPV")]),e._v(", Full-Block SPV, Full Block Downloading SPV Node.\nDownloads all the blocks from the creation of the wallet and does SPV verification on them.\nWait, did I just doubled the V word there?\nYes, developers are this inconsistent.\nI also hope nobody will ever build a full-SPV wallet that downloads all the blocks, but does centralized validation, because it is impossible to come up with a proper term for that.")]),e._v(" "),a("p",[e._v("Confused yet?\nGood.\nNow that you recognized the nuanced nature of the topic, you’ll be more forgiving for me butchering the rest of this section with vast oversimplifications:")]),e._v(" "),a("p",[a("code",[e._v("Hybrid Full Node")]),e._v(".\nIs A light node until the full node synchronizes.\nI want Wasabi to be such wallet in the future.")]),e._v(" "),a("p",[a("code",[e._v("BIP37")]),e._v(".\nClient sends bloom filter to full nodes, full nodes send back data matching the bloom filter.")]),e._v(" "),a("p",[a("code",[e._v("Bloom Filter")]),e._v(".\nLets you test if an element is in a set without revealing the set itself.")]),e._v(" "),a("p",[a("code",[e._v("Golomb-Rice Filters")]),e._v(".\nSmaller bloom filters, used by BIP158.")]),e._v(" "),a("p",[a("code",[e._v("Client Side Filtering")]),e._v(", Neutrino Filtering, "),a("a",{attrs:{href:"https://github.com/bitcoin/bips/blob/master/bip-0157.mediawiki",target:"_blank",rel:"noopener noreferrer"}},[e._v("BIP157"),a("OutboundLink")],1),e._v(", "),a("a",{attrs:{href:"https://github.com/bitcoin/bips/blob/master/bip-0158.mediawiki",target:"_blank",rel:"noopener noreferrer"}},[e._v("BIP158"),a("OutboundLink")],1),e._v(".\nThe idea that clients don’t have to send filters to full nodes, but rather they do the opposite: full nodes create filters and send them to clients instead.\nFrom here on clients can download blocks from other sources.\nIt’s a decently private way of establishing wallet UTXO state.")]),e._v(" "),a("p",[a("code",[e._v("Neutrino")]),e._v(".\nLightning Lab’s implementation of the client side filtering protocol.")]),e._v(" "),a("p",[a("code",[e._v("Whatever Wasabi Is Doing")]),e._v(".\nOur implementation of the client side filtering protocol.")]),e._v(" "),a("h2",{attrs:{id:"zooming-out"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zooming-out","aria-hidden":"true"}},[e._v("#")]),e._v(" Zooming Out")]),e._v(" "),a("p",[e._v("It is worth pointing out that network level privacy is just half of the battle.\nThe other half is the blockchain level privacy, which is outside of the scope of this article.")]),e._v(" "),a("p",[e._v("Furthermore network level privacy consists of two sub categories:")]),e._v(" "),a("ol",[a("li",[e._v("Private UTXO Retrieval")]),e._v(" "),a("li",[e._v("Private Transaction Broadcasting")])]),e._v(" "),a("h2",{attrs:{id:"bitcoin-core"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#bitcoin-core","aria-hidden":"true"}},[e._v("#")]),e._v(" Bitcoin Core")]),e._v(" "),a("h3",{attrs:{id:"private-utxo-retrieval"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#private-utxo-retrieval","aria-hidden":"true"}},[e._v("#")]),e._v(" Private UTXO Retrieval")]),e._v(" "),a("p",[e._v("Bitcoin Core downloads all the blocks ever created and establishes your wallet balances locally.")]),e._v(" "),a("h3",{attrs:{id:"private-transaction-broadcasting"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#private-transaction-broadcasting","aria-hidden":"true"}},[e._v("#")]),e._v(" Private Transaction Broadcasting")]),e._v(" "),a("p",[e._v("Bitcoin Core broadcasts transactions to other peers on the clearnet, unencrypted.\nOther peers cannot figure out which transaction originates from a specific node, because Core does not only broadcast its own transactions, but also propagates every other transaction that hits its mempool.\nHowever some papers note it’s not bulletproof:")]),e._v(" "),a("blockquote",[a("p",[e._v("Bitcoin transaction propagation does not hide the source of a transaction very well, especially against a “supernode” eavesdropper that forms a large number of outgoing connections to reachable nodes on the network "),a("a",{attrs:{href:"https://github.com/gfanti/bips/blob/master/bip-dandelion.mediawiki",target:"_blank",rel:"noopener noreferrer"}},[e._v("[1,2,3]"),a("OutboundLink")],1),e._v(".")])]),e._v(" "),a("p",[e._v("While in practice I suspect it doesn’t matter much, this article intends to examine the details in order to compare Core with Wasabi, thus I start collecting the relevant identified adversaries from here on:")]),e._v(" "),a("h3",{attrs:{id:"adversaries-identified"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#adversaries-identified","aria-hidden":"true"}},[e._v("#")]),e._v(" Adversaries Identified")]),e._v(" "),a("ul",[a("li",[e._v("Malicious Peer")]),e._v(" "),a("li",[e._v("Supernode")])]),e._v(" "),a("h2",{attrs:{id:"bitcoin-core-tor"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#bitcoin-core-tor","aria-hidden":"true"}},[e._v("#")]),e._v(" Bitcoin Core + Tor")]),e._v(" "),a("p",[e._v("You can use Bitcoin Core with Tor, which solves the above mentioned issue.\nIn this case a supernode cannot track back transactions to your IP address.")]),e._v(" "),a("p",[e._v("I will consider any entity that can break Tor, a universal adversary, however note, this is inaccurate.\nFor example most Tor attacks are not possible if exit nodes are not involved.\nThis and other things like Core’s configurability would overcomplicate the analysis, so that’s why I choose to draw the line here.\nI assume that this entity can break the onion routing, not Tor’s encryption itself.")]),e._v(" "),a("h3",{attrs:{id:"adversaries-identified-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#adversaries-identified-2","aria-hidden":"true"}},[e._v("#")]),e._v(" Adversaries Identified")]),e._v(" "),a("ul",[a("li",[e._v("Tor Breaker")])]),e._v(" "),a("h2",{attrs:{id:"wasabi-wallet"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wasabi-wallet","aria-hidden":"true"}},[e._v("#")]),e._v(" Wasabi Wallet")]),e._v(" "),a("h3",{attrs:{id:"private-transaction-broadcasting-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#private-transaction-broadcasting-2","aria-hidden":"true"}},[e._v("#")]),e._v(" Private Transaction Broadcasting")]),e._v(" "),a("p",[e._v("Wasabi previously did not maintain its P2P connections over Tor.\nSince Wasabi is a non-listening node, broadcasting transactions through other P2P nodes over the clearnet would’ve let the peer to link your IP address to the transaction.\nThis is why we were broadcasting our transactions to our backend server over Tor.")]),e._v(" "),a("p",[e._v("Now, we started tunneling all our P2P traffic through Tor, too:")]),e._v(" "),a("ul",[a("li",[e._v("We did it in a way that we only connect to onion nodes, so end to end encryption is now enforced between us and our peers.\nAll this without involving any exit node.")]),e._v(" "),a("li",[e._v("We connect to each peer through a different Tor stream.")]),e._v(" "),a("li",[e._v("This enabled us to replace our transaction broadcasting mechanism.\nNow, we broadcast transactions to only one peer over Tor and immediately after that we disconnect the peer.")])]),e._v(" "),a("h3",{attrs:{id:"private-utxo-retrieval-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#private-utxo-retrieval-2","aria-hidden":"true"}},[e._v("#")]),e._v(" Private UTXO Retrieval")]),e._v(" "),a("p",[e._v("Finally we arrived to the interesting part.\nBefore the P2P Tor implementation Wasabi was doing the following:")]),e._v(" "),a("p",[e._v("The backend server served a constant filter table to all the clients over Tor.\nFrom those filters the clients could figure out which blocks they are interested in and downloaded these blocks and some false-positive blocks from peers.\nOne block per peer.\nWhen a block was acquired, the peer was disconnected.\nThere were two issues with this. What if all the peers Wasabi connected to was the same entity for an extended period of time?\nThen the Sybil attacking entity would know all the blocks a client is interested in, of which some information could’ve been obtained.\nThe question arises?\nHow do you make sure you are the only peer a client connects to for en extended period of time?")]),e._v(" "),a("p",[e._v("The second issue is, what if your ISP is spying on you for an extended period of time?\nThis is more plausible.\nIn fact Wasabi’s privacy rating on Bitcoin.org listing was almost scored down to be the same as Bread wallet, because of this, which of course would’ve been ridiculous, since Bread is a BIP37 wallet.\nWhat saved the rating was that I noted, if ISP is an adversary, then Bitcoin Core would’ve failed that in a more spectacular way, since transactions are broadcasted over the clearnet and even if the node is listening, the only transaction that doesn’t come in, but only goes out of the wallet must be the one that originates from the node.")]),e._v(" "),a("p",[e._v("Anyway, Wasabi does this over Tor now.\nBecause of the end-to-end encryption of the onion network, it immediately defeats an ISP adversary and makes the already impossible job of the Sybil adversary even more impossible.\nHow do Sybil for an extended period of time, all the nodes those connect to Wasabi?\nOr even just one node?\nThe client is hiding behind Tor.\nYou cannot even tie together two connections of the client, since the client connects to all your Sybils through a different Tor stream.\nThe only adversary that could possibly overcome this would have to setup thousands of full nodes over onion and also break Tor itself.")]),e._v(" "),a("h3",{attrs:{id:"adversaries-identified-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#adversaries-identified-3","aria-hidden":"true"}},[e._v("#")]),e._v(" Adversaries Identified")]),e._v(" "),a("ul",[a("li",[e._v("ISP")]),e._v(" "),a("li",[e._v("Tor Breaker Sybil Attacker With Thousands Of Full Nodes Over Onion")])]),e._v(" "),a("h2",{attrs:{id:"wasabi-wallet-full-node"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wasabi-wallet-full-node","aria-hidden":"true"}},[e._v("#")]),e._v(" Wasabi Wallet + Full Node")]),e._v(" "),a("div",{staticClass:"ytEmbed"},[a("iframe",{attrs:{src:"https://www.youtube-nocookie.com/embed/gWo2RAkIVrE",frameborder:"0",allow:"autoplay;encrypted-media;picture-in-picture",allowfullscreen:""}})]),e._v(" "),a("h3",{attrs:{id:"private-utxo-retrieval-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#private-utxo-retrieval-3","aria-hidden":"true"}},[e._v("#")]),e._v(" Private UTXO Retrieval")]),e._v(" "),a("p",[e._v("If you have a listening full node running in the background (not only Bitcoin Core, any full node) then Wasabi automatically picks it up and instead of asking peers for blocks, it asks blocks from your own node.\nUsing Wasabi this way results in the same privacy model as Bitcoin Core’s regarding Private UTXO Retrieval.")]),e._v(" "),a("h2",{attrs:{id:"conclusion"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#conclusion","aria-hidden":"true"}},[e._v("#")]),e._v(" Conclusion")]),e._v(" "),a("blockquote",[a("p",[e._v("To be useful, security metrics should reflect the difficulty an adversary has in overcoming them. — "),a("a",{attrs:{href:"https://www.freehaven.net/anonbib/cache/entropist.pdf",target:"_blank",rel:"noopener noreferrer"}},[e._v("entropist"),a("OutboundLink")],1)])]),e._v(" "),a("p",[e._v("Because against all reasonable adversaries, a comparison between Bitcoin Core and Wasabi Wallet on network level privacy does not make sense you might think this article was a waste of time.\nBut you are greatly mistaken.\nThis article will surely help me win Internet arguments.\nAnd, in the end, isn’t that’s what really matters?")]),e._v(" "),a("div",{staticClass:"ytEmbed"},[a("iframe",{attrs:{src:"https://www.youtube-nocookie.com/embed/qguwAvA5Fx4",frameborder:"0",allow:"autoplay;encrypted-media;picture-in-picture",allowfullscreen:""}})])])},[],!1,null,null,null);t.default=o.exports}}]);